package cleaner

import (
	"code.google.com/p/go.net/html"
	"code.google.com/p/go.net/html/atom"
	"log"
	"strings"
	"testing"
)

func TestCleaner(t *testing.T) {
	root := &html.Node{Type: html.ElementNode, Data: "article", DataAtom: atom.Article}
	frag := `<!-- fullrss.net --><th height="100%" valign="top" style="padding:5px 15px 0 15px; border:0;width:80%; overflow:hidden"> <table width="100%" align="center" cellspacing="0" cellpadding="0" style="WORD-WRAP: break-word; height:100%;"><tbody><tr height="100%"><td bgcolor="" valign="top"> <div><a href="http://fullrss.net/r/http/184.154.128.246/profile.php?action=show&amp;uid=267564" target="_blank">?料</a> <a href="http://fullrss.net/r/http/184.154.128.246/message.php?action=write&amp;touid=267564" target="_blank">短信</a> <a href="http://fullrss.net/r/http/184.154.128.246/post.php?action=quote&amp;fid=2&amp;tid=971925&amp;pid=tpc&amp;article=0" target="_blank">引用</a> <a href="http://fullrss.net/r/http/184.154.128.246/sendemail.php?action=tofriend&amp;tid=971925" target="_blank">推?</a> <a href="http://fullrss.net/r/http/184.154.128.246/post.php?action=modify&amp;fid=2&amp;tid=971925&amp;pid=tpc&amp;article=0" target="_blank">??</a></div> <br><br><h4>[RMVB/794MB]蓝光原盘~ 店?推?作品(SKYHD-111) ?光天使降? Sky Angel Blue Vol.111 ?_ひとみHitomi</h4> <div style="width:auto"></div> <div></div> <br><div>【影片名?】: 蓝光原盘~ 店?推?作品(SKYHD-111) ?光天使降? Sky Angel Blue Vol.111 ?_ひとみHitomi<br> 【影片格式】: RMVB<br> 【影片大小】: 794MB<br> 【验证编码】: 53519af697f1dbbd3a0148cf5b532800596ffc66<br> 【播放软件】: QQ影音 暴风影音等<br> 【有??o?】: ?o?<br> 【种子期限】: 出3种后或做种3天<br><br> 【下载地址】: <a target="_blank" onmouseout="" style="cursor:pointer;color:#008000;font-size:14px" href="http://fullrss.net/r/http/www.viidii.com/?http%3A//www______xhcbb______com/link______php?ref=1aWiAGTUu8&amp;z"><img src="http://img3.imagehyper.com/t/0/3/3346/3346601-33e1ef72.gif" width="16" height="16" align="absmiddle"> http://www.xhcbb.com/link.php?ref=1aWiAGTUu8</a><br> 【影图预览】:<br><img src="http://i0.uyl.me/files/30278803830545514062.jpg" style="cursor:pointer"><br><img src="http://i0.uyl.me/files/93815692675421996002.jpg" style="cursor:pointer"><br><br><img src="http://108.imagebam.com/download/zZ_rLQX894E6NAPr8ZRbjg/28351/283503416/1.jpg" style="cursor:pointer"><br><img src="http://102.imagebam.com/download/7_tWBjXOojApH_P2N5tbEw/28351/283503417/2.jpg" style="cursor:pointer"><br><br><br> 【下载地址】: <a target="_blank" onmouseout="" style="cursor:pointer;color:#008000;font-size:14px" href="http://fullrss.net/r/http/www.viidii.com/?http%3A//www______xhcbb______com/link______php?ref=1aWiAGTUu8&amp;z"><img src="http://img3.imagehyper.com/t/0/3/3346/3346601-33e1ef72.gif" width="16" height="16" align="absmiddle"> http://www.xhcbb.com/link.php?ref=1aWiAGTUu8</a><br><br><br><br><br><a target="_blank" onmouseout="" style="cursor:pointer;color:#008000;font-size:14px" href="http://fullrss.net/r/http/www.viidii.com/?http%3A//www______rmdown______com/link______php?hash=13353519af697f1dbbd3a0148cf5b532800596ffc66&amp;z"><img src="http://img3.imagehyper.com/t/0/3/3346/3346601-33e1ef72.gif" width="16" height="16" align="absmiddle"> http://www.rmdown.com/link.php?hash=13353519af697f1dbbd3a0148cf5b532800596ffc66</a><br><br></div> </td> </tr></tbody></table></th><th height="100%" valign="top" style="padding:5px 15px 0 15px; border:0;width:80%; overflow:hidden"> <table width="100%" align="center" cellspacing="0" cellpadding="0" style="WORD-WRAP: break-word; height:100%;"><tbody><tr height="100%"><td bgcolor="" valign="top"> <div><a href="http://fullrss.net/r/http/184.154.128.246/profile.php?action=show&amp;uid=283873" target="_blank">?料</a> <a href="http://fullrss.net/r/http/184.154.128.246/message.php?action=write&amp;touid=283873" target="_blank">短信</a> <a href="http://fullrss.net/r/http/184.154.128.246/post.php?action=quote&amp;fid=2&amp;tid=971925&amp;pid=27674861&amp;article=1" target="_blank">引用</a> <a href="http://fullrss.net/r/http/184.154.128.246/sendemail.php?action=tofriend&amp;tid=971925" target="_blank">推?</a> <a href="http://fullrss.net/r/http/184.154.128.246/post.php?action=modify&amp;fid=2&amp;tid=971925&amp;pid=27674861&amp;article=1" target="_blank">??</a></div> <br><br><div style="width:auto"></div> <div></div> <br><div>支持ing</div> </td> </tr></tbody></table></th><th height="100%" valign="top" style="padding:5px 15px 0 15px; border:0;width:80%; overflow:hidden"> <table width="100%" align="center" cellspacing="0" cellpadding="0" style="WORD-WRAP: break-word; height:100%;"><tbody><tr height="100%"><td bgcolor="" valign="top"> <div><a href="http://fullrss.net/r/http/184.154.128.246/profile.php?action=show&amp;uid=280820" target="_blank">?料</a> <a href="http://fullrss.net/r/http/184.154.128.246/message.php?action=write&amp;touid=280820" target="_blank">短信</a> <a href="http://fullrss.net/r/http/184.154.128.246/post.php?action=quote&amp;fid=2&amp;tid=971925&amp;pid=27675100&amp;article=2" target="_blank">引用</a> <a href="http://fullrss.net/r/http/184.154.128.246/sendemail.php?action=tofriend&amp;tid=971925" target="_blank">推?</a> <a href="http://fullrss.net/r/http/184.154.128.246/post.php?action=modify&amp;fid=2&amp;tid=971925&amp;pid=27675100&amp;article=2" target="_blank">??</a></div> <br><br><div style="width:auto"></div> <div></div> <br><div>1024</div> </td> </tr></tbody></table></th><th height="100%" valign="top" style="padding:5px 15px 0 15px; border:0;width:80%; overflow:hidden"> <table width="100%" align="center" cellspacing="0" cellpadding="0" style="WORD-WRAP: break-word; height:100%;"><tbody><tr height="100%"><td bgcolor="" valign="top"> <div><a href="http://fullrss.net/r/http/184.154.128.246/profile.php?action=show&amp;uid=218312" target="_blank">?料</a> <a href="http://fullrss.net/r/http/184.154.128.246/message.php?action=write&amp;touid=218312" target="_blank">短信</a> <a href="http://fullrss.net/r/http/184.154.128.246/post.php?action=quote&amp;fid=2&amp;tid=971925&amp;pid=27675395&amp;article=3" target="_blank">引用</a> <a href="http://fullrss.net/r/http/184.154.128.246/sendemail.php?action=tofriend&amp;tid=971925" target="_blank">推?</a> <a href="http://fullrss.net/r/http/184.154.128.246/post.php?action=modify&amp;fid=2&amp;tid=971925&amp;pid=27675395&amp;article=3" target="_blank">??</a></div> <br><br><br><div>撸过看看</div> </td> </tr></tbody></table></th><th height="100%" valign="top" style="padding:5px 15px 0 15px; border:0;width:80%; overflow:hidden"> <table width="100%" align="center" cellspacing="0" cellpadding="0" style="WORD-WRAP: break-word; height:100%;"><tbody><tr height="100%"><td bgcolor="" valign="top"> <div><a href="http://fullrss.net/r/http/184.154.128.246/profile.php?action=show&amp;uid=280126" target="_blank">?料</a> <a href="http://fullrss.net/r/http/184.154.128.246/message.php?action=write&amp;touid=280126" target="_blank">短信</a> <a href="http://fullrss.net/r/http/184.154.128.246/post.php?action=quote&amp;fid=2&amp;tid=971925&amp;pid=27675771&amp;article=4" target="_blank">引用</a> <a href="http://fullrss.net/r/http/184.154.128.246/sendemail.php?action=tofriend&amp;tid=971925" target="_blank">推?</a> <a href="http://fullrss.net/r/http/184.154.128.246/post.php?action=modify&amp;fid=2&amp;tid=971925&amp;pid=27675771&amp;article=4" target="_blank">??</a></div> <br><br><br><div>谢谢分享</div> </td> </tr></tbody></table></th><th height="100%" valign="top" style="padding:5px 15px 0 15px; border:0;width:80%; overflow:hidden"> <table width="100%" align="center" cellspacing="0" cellpadding="0" style="WORD-WRAP: break-word; height:100%;"><tbody><tr height="100%"><td bgcolor="" valign="top"> <div><a href="http://fullrss.net/r/http/184.154.128.246/profile.php?action=show&amp;uid=279308" target="_blank">?料</a> <a href="http://fullrss.net/r/http/184.154.128.246/message.php?action=write&amp;touid=279308" target="_blank">短信</a> <a href="http://fullrss.net/r/http/184.154.128.246/post.php?action=quote&amp;fid=2&amp;tid=971925&amp;pid=27675883&amp;article=5" target="_blank">引用</a> <a href="http://fullrss.net/r/http/184.154.128.246/sendemail.php?action=tofriend&amp;tid=971925" target="_blank">推?</a> <a href="http://fullrss.net/r/http/184.154.128.246/post.php?action=modify&amp;fid=2&amp;tid=971925&amp;pid=27675883&amp;article=5" target="_blank">??</a></div> <br><br><br><div>支持发帖</div> </td> </tr></tbody></table></th><th height="100%" valign="top" style="padding:5px 15px 0 15px; border:0;width:80%; overflow:hidden"> <table width="100%" align="center" cellspacing="0" cellpadding="0" style="WORD-WRAP: break-word; height:100%;"><tbody><tr height="100%"><td bgcolor="" valign="top"> <div><a href="http://fullrss.net/r/http/184.154.128.246/profile.php?action=show&amp;uid=158567" target="_blank">?料</a> <a href="http://fullrss.net/r/http/184.154.128.246/message.php?action=write&amp;touid=158567" target="_blank">短信</a> <a href="http://fullrss.net/r/http/184.154.128.246/post.php?action=quote&amp;fid=2&amp;tid=971925&amp;pid=27678270&amp;article=6" target="_blank">引用</a> <a href="http://fullrss.net/r/http/184.154.128.246/sendemail.php?action=tofriend&amp;tid=971925" target="_blank">推?</a> <a href="http://fullrss.net/r/http/184.154.128.246/post.php?action=modify&amp;fid=2&amp;tid=971925&amp;pid=27678270&amp;article=6" target="_blank">??</a></div> <br><br><br><div>感谢发帖</div> </td> </tr></tbody></table></th><th height="100%" valign="top" style="padding:5px 15px 0 15px; border:0;width:80%; overflow:hidden"> <table width="100%" align="center" cellspacing="0" cellpadding="0" style="WORD-WRAP: break-word; height:100%;"><tbody><tr height="100%"><td bgcolor="" valign="top"> <div><a href="http://fullrss.net/r/http/184.154.128.246/profile.php?action=show&amp;uid=62295" target="_blank">?料</a> <a href="http://fullrss.net/r/http/184.154.128.246/message.php?action=write&amp;touid=62295" target="_blank">短信</a> <a href="http://fullrss.net/r/http/184.154.128.246/post.php?action=quote&amp;fid=2&amp;tid=971925&amp;pid=27680952&amp;article=7" target="_blank">引用</a> <a href="http://fullrss.net/r/http/184.154.128.246/sendemail.php?action=tofriend&amp;tid=971925" target="_blank">推?</a> <a href="http://fullrss.net/r/http/184.154.128.246/post.php?action=modify&amp;fid=2&amp;tid=971925&amp;pid=27680952&amp;article=7" target="_blank">??</a></div> <br><br><br><div>感谢分享</div> </td> </tr></tbody></table></th><th height="100%" valign="top" style="padding:5px 15px 0 15px; border:0;width:80%; overflow:hidden"> <table width="100%" align="center" cellspacing="0" cellpadding="0" style="WORD-WRAP: break-word; height:100%;"><tbody><tr height="100%"><td bgcolor="" valign="top"> <div><a href="http://fullrss.net/r/http/184.154.128.246/profile.php?action=show&amp;uid=89245" target="_blank">?料</a> <a href="http://fullrss.net/r/http/184.154.128.246/message.php?action=write&amp;touid=89245" target="_blank">短信</a> <a href="http://fullrss.net/r/http/184.154.128.246/post.php?action=quote&amp;fid=2&amp;tid=971925&amp;pid=27681580&amp;article=8" target="_blank">引用</a> <a href="http://fullrss.net/r/http/184.154.128.246/sendemail.php?action=tofriend&amp;tid=971925" target="_blank">推?</a> <a href="http://fullrss.net/r/http/184.154.128.246/post.php?action=modify&amp;fid=2&amp;tid=971925&amp;pid=27681580&amp;article=8" target="_blank">??</a></div> <br><br><br><div>1024</div> </td> </tr></tbody></table></th><th height="100%" valign="top" style="padding:5px 15px 0 15px; border:0;width:80%; overflow:hidden"> <table width="100%" align="center" cellspacing="0" cellpadding="0" style="WORD-WRAP: break-word; height:100%;"><tbody><tr height="100%"><td bgcolor="" valign="top"> <div><a href="http://fullrss.net/r/http/184.154.128.246/profile.php?action=show&amp;uid=19582" target="_blank">?料</a> <a href="http://fullrss.net/r/http/184.154.128.246/message.php?action=write&amp;touid=19582" target="_blank">短信</a> <a href="http://fullrss.net/r/http/184.154.128.246/post.php?action=quote&amp;fid=2&amp;tid=971925&amp;pid=27682515&amp;article=9" target="_blank">引用</a> <a href="http://fullrss.net/r/http/184.154.128.246/sendemail.php?action=tofriend&amp;tid=971925" target="_blank">推?</a> <a href="http://fullrss.net/r/http/184.154.128.246/post.php?action=modify&amp;fid=2&amp;tid=971925&amp;pid=27682515&amp;article=9" target="_blank">??</a></div> <br><br><br><div>1024</div> </td> </tr></tbody></table></th> <div style="clear: both;"><img src="http://fullrss.net/v/df37875df574a1c88f8c8dba00a84945/http/184.154.128.246/read.php?tid=971925"/></div> <div style="clear: both;text-align:right;"><a href="http://fullrss.net/">fullrss.net</a></div>`
	nodes, _ := html.ParseFragment(strings.NewReader(frag), root)
	for _, n := range nodes {
		root.AppendChild(n)
	}
	node := html_clean_fragment(root)
	print_html_doc(node)
	//	WriteHtmlFile(root, "../3.html.txt")
}

func print_html_doc(node *html.Node) {
	foreach_child(node, func(child *html.Node) {
		print_html_doc(child)
	})
	log.Println(trim(node.Data))
}

func trim(d string) string {
	if len(d) < 10 {
		return d
	}
	return d[:10]
}
