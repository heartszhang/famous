package cleaner

import (
	"bytes"
	"code.google.com/p/go.net/html"
	"code.google.com/p/go.net/html/atom"
	"log"
	"strings"
	"testing"
)

func TestCleaner(t *testing.T) {
	root := &html.Node{Type: html.ElementNode, Data: "article", DataAtom: atom.Article}
	frag := `<p><img src="http://ww1.sinaimg.cn/mw1024/635a50efgw1eaae3sikiuj20dw0il3zd.jpg" width="500" height="669" alt="还以为二货老公去哪了，仔细一看。。。" /></p> <a href="http://juetuzhi.net/2013/11/jue-tu-8743.html#comments" style="background-color:#FFFFCC; color:#CC0000;" title="看看大家都说了些什么"><strong>已有 0 人发表评论，猛击这里参与讨论</strong></a>。 <hr style="height:1px;"> © 2007-2011 <a href="http://juetuzhi.net/" target="_blank">掘图志</a> | <a href="http://feeds.juetuzhi.net/" target="_blank" title="订阅掘图志，精彩图片送上门">订阅</a> | <a href="http://juetuzhi.net/2013/11/jue-tu-8743.html" target="_blank" title="本文链接">本文链接</a> | <a href="http://weibo.com/geuro" title="关注掘图志的新浪微博">新浪微博</a> | <a href="http://t.qq.com/juetuzhi" title="关注掘图志的腾讯微博">腾讯微博</a><br /><table class="wumii-related-items" cellspacing="0" cellpadding="3" border="0" style="clear: both;"> <tr> <td colspan="5"><b><font size="-1" style="display: block !important; padding: 20px 0 5px !important;">您也许还喜欢：</font></b></td> </tr> <tr> <td width="126" valign="top" style="padding: 5px !important; margin: 0 !important;"> <a target="_blank" title="中国好老公。。。" style="text-decoration: none !important; cursor: pointer !important;" href="http://app.wumii.com/ext/redirect?url=http%3A%2F%2Fjuetuzhi.net%2F2013%2F08%2Fjue-tu-6698.html&from=http%3A%2F%2Fjuetuzhi.net%2F2013%2F11%2Fjue-tu-8743.html"> <img style="margin: 0 !important; padding: 2px !important; border: 1px solid #DDDDDD !important; width: 120px !important; height: 120px !important;" src="http://static.wumii.cn/site_images/ti/1hUkOSjrs.jpg?i=190UQrD2Q" width="120px" height="120px" /><br /> <font size="-1" style="display: block !important; line-height: 15px !important; width: 126px !important; font: 12px/15px arial !important; height: 60px !important; margin: 3px 0 0 0 !important; padding: 0 !important; overflow: hidden !important;">中国好老公。。。</font> </a> </td> <td width="126" valign="top" style="padding: 5px !important; margin: 0 !important; border-left: 1px solid #DDDDDD !important;"> <a target="_blank" title="老公睡觉时给他画了个胡子。。。" style="text-decoration: none !important; cursor: pointer !important;" href="http://app.wumii.com/ext/redirect?url=http%3A%2F%2Fjuetuzhi.net%2F2012%2F03%2Fhu-zi.html&from=http%3A%2F%2Fjuetuzhi.net%2F2013%2F11%2Fjue-tu-8743.html"> <img style="margin: 0 !important; padding: 2px !important; border: 1px solid #DDDDDD !important; width: 120px !important; height: 120px !important;" src="http://static.wumii.cn/resources/images/related_item_default/90.jpg" width="120px" height="120px" /><br /> <font size="-1" style="display: block !important; line-height: 15px !important; width: 126px !important; font: 12px/15px arial !important; height: 60px !important; margin: 3px 0 0 0 !important; padding: 0 !important; overflow: hidden !important;">老公睡觉时给他画了个胡子。。。</font> </a> </td> <td width="126" valign="top" style="padding: 5px !important; margin: 0 !important; border-left: 1px solid #DDDDDD !important;"> <a target="_blank" title="吉米鸡毛秀：如果你老公给别的女人发JJ的照片，你会挺他吗？" style="text-decoration: none !important; cursor: pointer !important;" href="http://app.wumii.com/ext/redirect?url=http%3A%2F%2Fjuetuzhi.net%2F2013%2F08%2Fjue-tu-6560.html&from=http%3A%2F%2Fjuetuzhi.net%2F2013%2F11%2Fjue-tu-8743.html"> <img style="margin: 0 !important; padding: 2px !important; border: 1px solid #DDDDDD !important; width: 120px !important; height: 120px !important;" src="http://static.wumii.cn/site_images/ti/U7WzhExM.jpg?i=O0MAoM70" width="120px" height="120px" /><br /> <font size="-1" style="display: block !important; line-height: 15px !important; width: 126px !important; font: 12px/15px arial !important; height: 60px !important; margin: 3px 0 0 0 !important; padding: 0 !important; overflow: hidden !important;">吉米鸡毛秀：如果你老公给别的女人发JJ的照片，你会挺他吗？</font> </a> </td> <td width="126" valign="top" style="padding: 5px !important; margin: 0 !important; border-left: 1px solid #DDDDDD !important;"> <a target="_blank" title="某媳妇儿给老公的带饭" style="text-decoration: none !important; cursor: pointer !important;" href="http://app.wumii.com/ext/redirect?url=http%3A%2F%2Fjuetuzhi.net%2F2010%2F08%2Fxiao-bian-dang-tang.html&from=http%3A%2F%2Fjuetuzhi.net%2F2013%2F11%2Fjue-tu-8743.html"> <img style="margin: 0 !important; padding: 2px !important; border: 1px solid #DDDDDD !important; width: 120px !important; height: 120px !important;" src="http://static.wumii.cn/resources/images/related_item_default/47.jpg" width="120px" height="120px" /><br /> <font size="-1" style="display: block !important; line-height: 15px !important; width: 126px !important; font: 12px/15px arial !important; height: 60px !important; margin: 3px 0 0 0 !important; padding: 0 !important; overflow: hidden !important;">某媳妇儿给老公的带饭</font> </a> </td> <td width="126" valign="top" style="padding: 5px !important; margin: 0 !important; border-left: 1px solid #DDDDDD !important;"> <a target="_blank" title="[视频]让你们见识一下真正的有钱人是什么样的，老公我爱死你了…" style="text-decoration: none !important; cursor: pointer !important;" href="http://app.wumii.com/ext/redirect?url=http%3A%2F%2Fjuetuzhi.net%2F2010%2F12%2Fyou-qian-ren.html&from=http%3A%2F%2Fjuetuzhi.net%2F2013%2F11%2Fjue-tu-8743.html"> <img style="margin: 0 !important; padding: 2px !important; border: 1px solid #DDDDDD !important; width: 120px !important; height: 120px !important;" src="http://static.wumii.cn/site_images/ti/319RY47A.jpg?i=ucQgWNlp" width="120px" height="120px" /><br /> <font size="-1" style="display: block !important; line-height: 15px !important; width: 126px !important; font: 12px/15px arial !important; height: 60px !important; margin: 3px 0 0 0 !important; padding: 0 !important; overflow: hidden !important;">[视频]让你们见识一下真正的有钱人是什么样的，老公我爱死你了…</font> </a> </td> </tr> <tr> <td colspan="5" align="right"> <a style="text-decoration: none !important;" href="http://www.wumii.com/widget/relatedItems" target="_blank" title="无觅关联推荐"> <font size="-1" color="#bbbbbb" style="display: block !important; font-family: arial !important; padding: 5px 0 !important; font-size: 12px !important; color: #bbb !important;">无觅</font> </a> </td> </tr> </table><img width='1' height='1' src='http://juetuzhi.feedsportal.com/c/34719/f/638620/s/3351d22c/sc/17/mf.gif' border='0'/><br clear='all'/><br/><br/><a href="http://da.feedsportal.com/r/180263598621/u/0/f/638620/c/34719/s/3351d22c/a2.htm"><img src="http://da.feedsportal.com/r/180263598621/u/0/f/638620/c/34719/s/3351d22c/a2.img" border="0"/></a><img width="1" height="1" src="http://pi.feedsportal.com/r/180263598621/u/0/f/638620/c/34719/s/3351d22c/a2t.img" border="0"/>`
	nodes, _ := html.ParseFragment(strings.NewReader(frag), root)
	for _, n := range nodes {
		root.AppendChild(n)
	}
	article, sum, _ := MakeFragmentReadable(root)
	log.Println(sum)
	print_html_doc(article)
}

func print_html_doc(node *html.Node) {
	var buffer bytes.Buffer
	html.Render(&buffer, node) // ignore return error
	log.Println(buffer.String())
}

func trim(d string) string {
	if len(d) < 10 {
		return d
	}
	return d[:10]
}
